{"version":3,"file":"@index.js.map","sources":["@index.js","$.js","main.js","events.js","balls.js"],"sourcesContent":["var require = function() {\r\n    var modules = {};\r\n    \r\n    return function(id, body) {\r\n        var mod;\r\n        body = window[\"#\" + id];\r\n        if (typeof body === 'undefined') {\r\n            var err = new Error(\"Required module is missing: \" + id);   \r\n            console.error(err.stack);\r\n            throw err;\r\n        }\r\n        mod = modules[id];\r\n        if (typeof mod === 'undefined') {\r\n            mod = {exports: {}};\r\n            var exports = mod.exports;\r\n            body(exports, mod);\r\n            modules[id] = mod.exports;\r\n            mod = mod.exports;\r\n            //console.log(\"Module initialized: \" + id);\r\n        }\r\n        return mod;\r\n    };\r\n}();\r\nfunction addListener(e,l) {\r\n    if (window.addEventListener) {\r\n        window.addEventListener(e,l,false);\r\n    } else {\r\n        window.attachEvent('on' + e, l);\r\n    }\r\n};\r\n\r\naddListener(\r\n    'DOMContentLoaded',\r\n    function() {\r\n        document.body.parentNode.$data = {};\r\n        // Attach controllers.\r\n        APP = require('main');\nsetTimeout(function (){if(typeof APP.start==='function')APP.start()});\r\n    }\r\n);\r\n","window['#$']=function(exports,module){  exports.config={\n    name:\"demo-bouncing-balls\",\n    description:\"WebGL demo of bouncing balls\",\n    author:\"Tolokoban\",\n    version:\"1.0.5\",\n    major:1,\n    minor:0,\n    revision:5,\n    date:new Date(2016,1,16,9,34,19)\n};\nvar currentLang = null;\r\nexports.lang = function(lang) {\r\n    if (lang === undefined) {\r\n        lang = window.localStorage.getItem(\"Language\");\r\n        if (!lang) {\r\n            lang = window.navigator.language;\r\n            if (!lang) {\r\n                lang = window.navigator.browserLanguage;\r\n                if (!lang) {\r\n                    lang = \"fr\";\r\n                }\r\n            }\r\n        }\r\n        lang = lang.substr(0, 2).toLowerCase();\r\n    }\r\n    currentLang = lang;\r\n    window.localStorage.setItem(\"Language\", lang);\r\n    return lang;\r\n};\r\nexports.intl = function(words, params) {\r\n    var dic = words[exports.lang()],\r\n    k = params[0],\r\n    txt, newTxt, i, c, lastIdx, pos;\r\n    if (!dic) {\r\n        //console.error(\"Missing internationalization for language : \\\"\" + exports.lang() + \"\\\"!\");\r\n        return k;\r\n    }\r\n    txt = dic[k];\r\n    if (!txt) {\r\n        //console.error(\"Missing internationalization [\" + exports.lang() + \"]: \\\"\" + k + \"\\\"!\");\r\n        return k;\r\n    }\r\n    if (params.length > 1) {\r\n        newTxt = \"\";\r\n        lastIdx = 0;\r\n        for (i = 0 ; i < txt.length ; i++) {\r\n            c = txt.charAt(i);\r\n            if (c === '$') {\r\n                newTxt += txt.substring(lastIdx, i);\r\n                i++;\r\n                pos = txt.charCodeAt(i) - 48;\r\n                if (pos < 0 || pos >= params.length) {\r\n                    newTxt += \"$\" + txt.charAt(i);\r\n                } else {\r\n                    newTxt += params[pos];\r\n                }\r\n                lastIdx = i + 1;\r\n            } else if (c === '\\\\') {\r\n                newTxt += txt.substring(lastIdx, i);\r\n                i++;\r\n                newTxt += txt.charAt(i);\r\n                lastIdx = i + 1;\r\n            }\r\n        }\r\n        newTxt += txt.substr(lastIdx);\r\n        txt = newTxt;\r\n    }\r\n    return txt;\r\n};\r\n }\r\n","window['#main']=function(exports,module){  var Balls = require(\"balls\");\r\nvar Events = require(\"events\");\r\n//var Impacts = require(\"impacts\");\r\n\r\nvar BALLS = 100;\r\n\r\n// Div where to put the frames per second.\r\nvar fps = document.getElementById('fps');\r\n\r\nvar cameraMotion = {\r\n    alpha: Math.PI * Math.random(),\r\n    beta: Math.random() * Math.PI / 2,\r\n    speed: {\r\n        alpha: Math.random() * 0.0007,\r\n        beta: Math.random() * 0.0001\r\n    },\r\n    radius: 40,\r\n    radiusTarget: 12,\r\n    target: Balls.center\r\n};\r\n\r\nvar scene = new THREE.Scene();\r\nvar camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 1000 );\r\nvar renderer = new THREE.WebGLRenderer({ alpha: true });\r\nrenderer.setClearColor( 0x000000, 0.0);\r\nrenderer.setPixelRatio( window.devicePixelRatio );\r\nrenderer.setSize( window.innerWidth, window.innerHeight );\r\ndocument.body.appendChild( renderer.domElement );\r\n\r\ncreateFloorGrid();\r\n\r\n// Adding balls.\r\nBalls.create( BALLS ).forEach(function ( mesh ) {\r\n    scene.add( mesh );\r\n});\r\n\r\n//Impacts.setScene( scene );\r\n\r\n\r\nfunction createFloorGrid() {\r\n    var x, z;\r\n    var b = Balls.bounds;\r\n\r\n    for ( x=b.x ; x<=b.X ; x++ ) {\r\n        scene.add(\r\n            createLine({\r\n                vertices: [[x, b.y, b.z], [x, b.y, b.Z]]\r\n            })\r\n        );\r\n    }\r\n    for ( z=b.z ; z<=b.Z ; z++ ) {\r\n        scene.add(\r\n            createLine({\r\n                vertices: [[b.x, b.y, z], [b.X, b.y, z]]\r\n            })\r\n        );\r\n    }\r\n}\r\n\r\n\r\nwindow.addEventListener( 'resize', onWindowResize, false );\r\n\r\nvar events = Events( renderer.domElement );\r\n\r\nevents.onStart = function() {\r\n    cameraMotion.speed.alpha = cameraMotion.speed.beta = 0;\r\n};\r\n\r\nevents.onDrag = function( evt ) {\r\n    var x = evt.sx / window.innerWidth;\r\n    var y = evt.sy / window.innerHeight;\r\n    var speed = 0.001;\r\n\r\n    cameraMotion.speed.alpha = constraint( x * speed, -.01, .01 );\r\n    cameraMotion.speed.beta = constraint( y * speed * .2, -.01, .01 );\r\n};\r\n\r\nevents.onDblSwipe = function( evt ) {\r\n    var y = evt.y / window.innerHeight;\r\n    cameraMotion.radiusTarget = cameraMotion.radius = constraint( 31 * y, 1, 31 );\r\n};\r\n\r\nevents.onWheel = function( delta ) {\r\n    if (delta > 0) delta = 1;\r\n    else delta = -1;\r\n    cameraMotion.radiusTarget -= delta;\r\n    cameraMotion.radiusTarget = Math.max( 1, cameraMotion.radiusTarget );\r\n    cameraMotion.radiusTarget = Math.min( 30, cameraMotion.radiusTarget );\r\n};\r\n\r\nfunction onWindowResize() {\r\n    var W = window.innerWidth;\r\n    var H = window.innerHeight;\r\n\r\n    camera.aspect = W / H;\r\n    camera.updateProjectionMatrix();\r\n    renderer.setSize( W, H );\r\n}\r\n\r\n\r\n\r\n\r\nvar lastTime = 0;\r\nvar fpsTime = 0;\r\nvar nbFrames = 0;\r\n\r\nfunction anim( time ) {\r\n    window.requestAnimationFrame( anim );\r\n    if (!lastTime) {\r\n        lastTime = time;\r\n        fpsTime = time;\r\n        nbFrames = 0;\r\n        return;\r\n    }\r\n    nbFrames++;\r\n    if (nbFrames == 10) {\r\n        fps.textContent = (10000 / (time - fpsTime)).toFixed(0) + \" fps\";\r\n        fpsTime = time;\r\n        nbFrames = 0;\r\n    }\r\n    var delta = time - lastTime;\r\n    var impacts = Balls.move( time, delta, cameraMotion );\r\n    //Impacts.add( impacts );\r\n    //Impacts.move( time, delta );\r\n    moveCamera( time, delta );\r\n    lastTime = time;\r\n    // Ask WebGL to refresh the screen.\r\n    renderer.render( scene, camera );\r\n}\r\n\r\nwindow.requestAnimationFrame( anim );\r\n\r\n\r\nfunction moveCamera( time, delta ) {\r\n    var cam = cameraMotion;\r\n\r\n    cam.alpha = cam.alpha + delta* cam.speed.alpha;\r\n    cam.beta = cam.beta + delta * cam.speed.beta;\r\n    if (cam.beta < 0) {\r\n        cam.beta = 0;\r\n        cam.speed.beta = Math.abs( cam.speed.beta );\r\n    }\r\n    if (cam.beta > Math.PI / 2) {\r\n        cam.beta = Math.PI / 2;\r\n        cam.speed.beta = -Math.abs( cam.speed.beta );\r\n    }\r\n\r\n    if (cam.radius < cam.radiusTarget) {\r\n        cam.radius = Math.min( cam.radiusTarget, cam.radius + delta * 0.01 );\r\n    }\r\n    else if (cam.radius > cam.radiusTarget) {\r\n        cam.radius = Math.max( cam.radiusTarget, cam.radius - delta * 0.01 );\r\n    }\r\n    \r\n    var R = cam.radius;\r\n    var r = R * Math.cos( cam.beta );\r\n    var x = r * Math.cos( cam.alpha );\r\n    var y = R * Math.sin( cam.beta );\r\n    var z = r * Math.sin( cam.alpha );\r\n\r\n    camera.position.x = x + cam.target.x;\r\n    camera.position.y = y + cam.target.y;\r\n    camera.position.z = z + cam.target.z;\r\n    camera.lookAt( cam.target );\r\n}\r\n\r\n\r\nfunction constraint( v, min, max ) {\r\n    return Math.max( min, Math.min( max, v ) );\r\n}\r\n\r\nfunction createLine(opt) {\r\n    if (typeof opt === 'undefined') opt = { vertices: [] };\r\n    if (typeof opt.color === 'undefined') opt.color = 0x000000;\r\n    if (typeof opt.linewidth === 'undefined') opt.linewidth = 1;\r\n\r\n\r\n    var mat = new THREE.LineBasicMaterial({\r\n        color: opt.color,\r\n        linewidth: opt.linewidth\r\n    });\r\n\r\n    var geo = new THREE.Geometry();\r\n    opt.vertices.forEach(function (vertex) {\r\n        geo.vertices.push(\r\n            new THREE.Vector3( vertex[0], vertex[1], vertex[2] )\r\n        );\r\n    });\r\n\r\n    return new THREE.Line( geo, mat );\r\n};\r\n\r\n\r\n }\r\n","window['#events']=function(exports,module){  function getZoomAttributes( touches ) {\r\n    var x1 = touches[0].clientX;\r\n    var y1 = touches[0].clientY;\r\n    var x2 = touches[1].clientX;\r\n    var y2 = touches[1].clientY;\r\n\r\n    var cx = (x1 + x2) * .5;\r\n    var cy = (y1 + y2) * .5;\r\n    var dx = (x1 - x2) * .5;\r\n    var dy = (y1 - y2) * .5;\r\n    var radius = Math.sqrt( dx*dx + dy*dy );\r\n\r\n    return {\r\n        cx: cx, cy: cy,\r\n        radius: radius,\r\n        time: Date.now()\r\n    };\r\n}\r\n\r\n\r\nmodule.exports = function( element ) {\r\n    var slots = {\r\n        onStart: function( evt ) {},\r\n        onStop: function( evt ) {},\r\n        onZoom: function( delta ) {},\r\n        onWheel: function( evt ) {},\r\n        onDblSwipe: function( evt ) {\r\n            console.log(\"not implemented!\");\r\n        },\r\n        onMove: function( evt ) {},\r\n        onDrag: function( evt ) {},\r\n        onTap: function( evt ) {},\r\n        // Read only\r\n        target: element,\r\n        // Radius for  Tap. If  the pointer  moved more than `threshold`\r\n        // pixels, this is not consideder as a Tap.\r\n        threshold: 8,\r\n        // In double finger touch mode, don't send more than one onWheel\r\n        // event per `wheelDelay` milliseconds.\r\n        wheelDelay: 200\r\n    };\r\n    // 0 = no touch nor mouse down\r\n    // 1 = Mouse is down\r\n    // 2 = touch has started\r\n    var state = 0;\r\n    var x0, y0;\r\n    var xx, yy;\r\n    var t0 = 0;   // Last touch/press\r\n    var t1 = 0;   // Last move\r\n    var zoom0, zoom1;\r\n    var wheelTime = 0;\r\n\r\n    function handleMouseMove( event ) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        var x = event.clientX;\r\n        var y = event.clientY;\r\n\r\n        if (state == 0) {\r\n            slots.onMove({ x: x, y: y });\r\n        }\r\n        else if (state == 1) {\r\n            var t = Date.now();\r\n            var d = 1000 / Math.max( 1, t - t1 );\r\n            slots.onDrag({\r\n                x0: x0, y0: y0,\r\n                xx: xx, yy: yy,\r\n                sx: (x - xx) * d,  // Pixels / second\r\n                sy: (y - yy) * d,  // Pixels / second\r\n                x: x, y: y\r\n            });\r\n            xx = x;\r\n            yy = y;\r\n            t1 = t;\r\n        }\r\n    }\r\n\r\n    function handleMouseDown( event ) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        if (state == 2) return;\r\n\r\n        state = 1;\r\n        x0 = xx = event.clientX;\r\n        y0 = yy = event.clientY;\r\n        t0 = t1 = Date.now();\r\n        slots.onStart({ x: x0, y: y0 });\r\n    }\r\n\r\n    function handleMouseUp( event ) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        if (state != 1) return;\r\n\r\n        state = 0;\r\n\r\n        var x = event.clientX;\r\n        var y = event.clientY;\r\n        var dx = Math.abs(x - x0);\r\n        var dy = Math.abs(y - y0);\r\n        x0 = x;\r\n        y0 = y;\r\n        if (Math.max( dx, dy) > slots.threshold) {\r\n            return;\r\n        }\r\n        slots.onStop({ x: x, y: y });\r\n    }\r\n\r\n    function handleTouchMove( event ) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        var x, y, d;\r\n        \r\n        if (state == 2) {\r\n            var t = Date.now();\r\n            var touches = event.touches;\r\n            if (touches.length == 1) {\r\n                x = touches[0].clientX;\r\n                y = touches[0].clientY;\r\n                d = 1000 / Math.max( 1, t - t1 );\r\n                slots.onDrag({\r\n                    x0: x0, y0: y0,\r\n                    xx: xx, yy: yy,\r\n                    sx: (x - xx) * d,  // Pixels / second\r\n                    sy: (y - yy) * d,  // Pixels / second\r\n                    x: x, y: y\r\n                });\r\n                xx = x;\r\n                yy = y;\r\n                t1 = t;\r\n            }\r\n            else if (touches.length == 2) {\r\n                var z = getZoomAttributes( touches );\r\n                x = z.cx;\r\n                y = z.cy;\r\n                d = 1000 / Math.max( 1, t - z.time );\r\n                console.log(\"Calling onDblSwipe()\");\r\n                slots.onDblSwipe({\r\n                    x0: zoom0.cx, y0: zoom0.cy,\r\n                    xx: zoom1.cx, yy: zoom1.cy,\r\n                    sx: (x - zoom1.cx) * d,  // Pixels / second\r\n                    sy: (y - zoom1.cy) * d,  // Pixels / second\r\n                    x: x, y: y\r\n                });\r\n                zoom1 = z;\r\n            }\r\n        }\r\n    }\r\n\r\n    function handleTouchStart( event ) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        if (state == 1) return;\r\n\r\n        var touches = event.touches;\r\n        if (touches.length == 1) {\r\n            state = 2;\r\n            x0 = xx = touches[0].clientX;\r\n            y0 = yy = touches[0].clientY;\r\n            t0 = t1 = Date.now();\r\n            slots.onStart({ x: x0, y: y0 });\r\n        }\r\n        else if (touches.length == 2) {\r\n            zoom0 = zoom1 = getZoomAttributes( touches );\r\n        }\r\n    }\r\n\r\n    function handleTouchEnd( event ) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        if (state != 2) return;\r\n\r\n        var touches = event.touches;\r\n        if (touches.length == 1) {\r\n            state = 0;\r\n\r\n            var x = touches[0].clientX;\r\n            var y = touches[0].clientY;\r\n            var dx = Math.abs(x - x0);\r\n            var dy = Math.abs(y - y0);\r\n            x0 = x;\r\n            y0 = y;\r\n            if (Math.max( dx, dy) > slots.threshold) {\r\n                return;\r\n            }\r\n            slots.onStop({ x: x, y: y });\r\n        }\r\n    }\r\n\r\n    function handleMouseWheel( event ) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        var delta = 0;\r\n        if ( event.wheelDelta !== undefined ) {\r\n            // WebKit / Opera / Explorer 9\r\n            delta = event.wheelDelta;\r\n        } else if ( event.detail !== undefined ) {\r\n            // Firefox\r\n            delta = - event.detail;\r\n        }\r\n\r\n        if ( delta != 0) {\r\n            slots.onWheel( delta > 0 ? 1 : -1 );\r\n        }\r\n    }\r\n\r\n\r\n    element.addEventListener( 'touchmove', handleTouchMove, false );\r\n    element.addEventListener( 'touchstart', handleTouchStart, false );\r\n    element.addEventListener( 'touchend', handleTouchEnd, false );\r\n    element.addEventListener( 'mousewheel', handleMouseWheel, false );\r\n    element.addEventListener( 'MozMousePixelScroll', handleMouseWheel, false ); // firefox\r\n    element.addEventListener( 'mousemove', handleMouseMove, false );\r\n    element.addEventListener( 'mousedown', handleMouseDown, false );\r\n    element.addEventListener( 'mouseup', handleMouseUp, false );\r\n\r\n    return slots;\r\n};\r\n }\r\n","window['#balls']=function(exports,module){  /****************************************\r\n This modules deals with balls creation and animation.\r\n\r\n Exports:\r\n * `center`:\r\n * `create( nbBalls )`:\r\n * `move( time, delta )`:\r\n ****************************************/\r\n\r\n// Bounds of the box in which the balls bounce.\r\nvar bounds = {\r\n    x: -7, X: 7,\r\n    y: 0, Y: 7,\r\n    z: -7, Z: 7\r\n};\r\n// Point the camera loot at.\r\nvar center = new THREE.Vector3(\r\n    0.5 * (bounds.x + bounds.X),\r\n    bounds.y + 1,\r\n    0.5 * (bounds.z + bounds.Z)\r\n);\r\n// Array of the objects describing the balls.\r\n// { mesh:..., vx,..., vy:..., vz:..., x:..., y:..., z:..., delta:...}\r\nvar balls = [];\r\n\r\nfunction createBalls(nbBalls) {\r\n    var meshes = [];\r\n    var ball;\r\n    for ( var i=0 ; i<nbBalls ; i++ ) {\r\n        ball = {\r\n            mesh: new THREE.Mesh( createGeo(), createMat() ),\r\n            vx: (Math.random() - .5) * 10,\r\n            vy: (Math.random() - .5),\r\n            vz: (Math.random() - .5) * 10,\r\n            x: rnd( bounds.x, bounds.X ),\r\n            y: rnd( bounds.y, bounds.Y ),\r\n            z: rnd( bounds.z, bounds.Z ),\r\n            flash: 1,\r\n            delta: 1\r\n        };\r\n        ball.mesh.position.set( ball.x, ball.y, ball.z );\r\n        balls.push( ball );\r\n        meshes.push( ball.mesh );\r\n    }\r\n    return meshes;\r\n}\r\n\r\n\r\n/**\r\n * Create  a   shader  material  using  the   shaders  `vertex.c`  and\r\n * `fragment.c`.\r\n */\r\nfunction createMat() {\r\n    var col = randomColor();\r\n    var vec = new THREE.Vector3( col.r, col.g, col.b );\r\n    var mat = new THREE.ShaderMaterial({\r\n        uniforms: {\r\n            uni_Color: { type: \"v3\", value: vec },\r\n            uni_Ratio: { type: \"f\", value: window.innerWidth / window.innerHeight },\r\n            uni_Alpha: { type: \"f\", value: 0 },\r\n            uni_Beta: { type: \"f\", value: 0 },\r\n            uni_Time: { type: \"f\", value: 0 },\r\n            uni_Speed: { type: \"f\", value: (Math.random() - .5) * 0.01 },\r\n            uni_Flash: { type: \"f\", value: 0 }\r\n        },\r\n        vertexShader: document.getElementById( 'vertex' ).textContent,\r\n        fragmentShader: document.getElementById( 'fragment' ).textContent,\r\n        transparent: true\r\n    });\r\n    return mat;\r\n};\r\n\r\n\r\n/**\r\n * Create the geometry of a single square centered in (0,0,0) on plane\r\n * Z=0 and with a side of length 1.\r\n */\r\nfunction createGeo() {\r\n    var geo = new THREE.Geometry();\r\n    geo.vertices.push(\r\n        new THREE.Vector3( -.5, -.5, 0 ),\r\n        new THREE.Vector3(  .5, -.5, 0 ),\r\n        new THREE.Vector3(  .5,  .5, 0 ),\r\n        new THREE.Vector3( -.5,  .5, 0 )\r\n    );\r\n    geo.faces.push(\r\n        new THREE.Face3( 0, 1, 2 ),\r\n        new THREE.Face3( 0, 2, 3 )\r\n    );\r\n    geo.computeFaceNormals ();\r\n    geo.computeVertexNormals ();\r\n    return geo;\r\n}\r\n\r\n\r\n/**\r\n * Bounces of the balls.\r\n */\r\nfunction moveBalls( time, delta, cameraMotion ) {\r\n    var impacts = [];\r\n    \r\n    delta = Math.min( 160, delta );\r\n    var bx = bounds.x + .5;\r\n    var bX = bounds.X - .5;\r\n    var by = bounds.y + .5;\r\n    var bY = bounds.Y - .5;\r\n    var bz = bounds.z + .5;\r\n    var bZ = bounds.Z - .5;\r\n    var speed = 0.0002;\r\n\r\n    var ratio = window.innerWidth / window.innerHeight;\r\n\r\n    bounceBalls();\r\n\r\n    balls.forEach(function (ball) {\r\n        // Gravity.\r\n        ball.vy -= delta * speed;\r\n\r\n        // Move the ball.\r\n        var mesh = ball.mesh;\r\n        var pos = mesh.position;\r\n        mesh.material.uniforms.uni_Ratio.value = window.innerWidth / window.innerHeight;\r\n        mesh.material.uniforms.uni_Alpha.value = cameraMotion.alpha;\r\n        mesh.material.uniforms.uni_Beta.value = cameraMotion.beta;\r\n        mesh.material.uniforms.uni_Time.value = time;\r\n        mesh.material.uniforms.uni_Flash.value = ball.flash;\r\n\r\n        ball.flash = Math.max( 0, ball.flash - delta * 0.003);\r\n        \r\n        pos.x = ball.x + ball.vx * delta * speed;\r\n        pos.y = ball.y + ball.vy * delta * speed;\r\n        pos.z = ball.z + ball.vz * delta * speed;\r\n\r\n        // Detect bounces.\r\n        if (pos.x < bx) {\r\n            ball.vx = -ball.vx;\r\n            pos.x = bx;\r\n        }\r\n        if (pos.x > bX) {\r\n            ball.vx = -ball.vx;\r\n            pos.x = bX;\r\n        }\r\n        if (pos.y < by) {\r\n            ball.vy = -ball.vy;\r\n            if (ball.vy < 0.001) {\r\n                // Bounces are amortized and they can stop entirely.\r\n                ball.vy = Math.random() * 5;\r\n            }\r\n            /*\r\n            impacts.push({\r\n                color: mesh.material.uniforms.uni_Color.value,\r\n                x: pos.x, y: by - .5, z: pos.z, t: 'y'\r\n            });\r\n             */\r\n            pos.y = by;\r\n        }\r\n        if (pos.y > bY) {\r\n            ball.vy = -ball.vy;\r\n            pos.y = bY;\r\n        }\r\n        if (pos.z < bz) {\r\n            ball.vz = -ball.vz;\r\n            pos.z = bz;\r\n        }\r\n        if (pos.z > bZ) {\r\n            ball.vz = -ball.vz;\r\n            pos.z = bZ;\r\n        }\r\n\r\n        // Save current position and delta.\r\n        ball.x = pos.x;\r\n        ball.y = pos.y;\r\n        ball.z = pos.z;\r\n        ball.delta = delta;\r\n    }, this);\r\n\r\n    return impacts;\r\n}\r\n\r\n\r\n// Make balls bounce on each other.\r\nfunction bounceBalls() {\r\n    var a, b;\r\n    var ballA, ballB;\r\n    // Coords of the normal vector.\r\n    // This is a vector between the centre of both colliding balls.\r\n    var nx, ny, nz;\r\n    // r2 = nx^2 + ny^2 + nz^2\r\n    var r2;\r\n    // r = sqrt( r2 );\r\n    var r;\r\n    // Projection of  the ball's direction  on the normal vector  of the\r\n    // contact between two balls.\r\n    var proj;\r\n    // Mesh position;\r\n    var pA, pB;\r\n    // Center between both balls.\r\n    var cx, cy, cz;\r\n    \r\n    for ( a=0 ; a<balls.length - 1; a++ ) {\r\n        ballA = balls[a];\r\n        pA = ballA.mesh.position;\r\n        for ( b=a+1 ; b<balls.length ; b++ ) {\r\n            ballB = balls[b];\r\n            pB = ballB.mesh.position;\r\n            // Already colliding?\r\n            if (ballB.flash > 0 && ballA.flash > 0) break;\r\n            nx = pB.x - pA.x;\r\n            ny = pB.y - pA.y;\r\n            nz = pB.z - pA.z;\r\n            r2 = nx*nx + ny*ny + nz*nz;\r\n            if (r2 >= 1) break;\r\n            // Prevent extremly rare division by zero.\r\n            if (r2 == 0) break;\r\n            // ballA and ballB are colliding.\r\n            cx = (pB.x + pA.x) * 0.5;\r\n            cy = (pB.y + pA.y) * 0.5;\r\n            cz = (pB.z + pA.z) * 0.5;\r\n            r = Math.sqrt( r2 );\r\n            // Normalizing the normal vector A->B.\r\n            nx /= r;\r\n            ny /= r;\r\n            nz /= r;\r\n            // Min distance between ballA and ballB must be 1.\r\n            pA.x = cx - nx * 0.5;\r\n            pA.y = cy - ny * 0.5;\r\n            pA.z = cz - nz * 0.5;\r\n            pB.x = cx + nx * 0.5;\r\n            pB.y = cy + ny * 0.5;\r\n            pB.z = cz + nz * 0.5;\r\n            // Compute bounce.\r\n            proj = Math.abs( ballA.vx * nx + ballA.vy * ny + ballA.vz * nz );\r\n            ballA.vx -= 2 * proj * nx;\r\n            ballA.vy -= 2 * proj * ny;\r\n            ballA.vz -= 2 * proj * nz;\r\n            proj = Math.abs( ballB.vx * nx + ballB.vy * ny + ballB.vz * nz );\r\n            ballB.vx += 2 * proj * nx;\r\n            ballB.vy += 2 * proj * ny;\r\n            ballB.vz += 2 * proj * nz;\r\n            // Two colliding balls emit a flash.\r\n            ballA.flash = 1;\r\n            ballB.flash = 1;\r\n            // Limit balls' speed.\r\n            if (ballA.vx > 5) ballA.vx = 5;\r\n            if (ballA.vx < -5) ballA.vx = -5;\r\n            if (ballA.vy > 5) ballA.vy = 5;\r\n            if (ballA.vy < -5) ballA.vy = -5;\r\n            if (ballA.vz > 5) ballA.vz = 5;\r\n            if (ballA.vz < -5) ballA.vz = -5;\r\n            if (ballB.vx > 5) ballB.vx = 5;\r\n            if (ballB.vx < -5) ballB.vx = -5;\r\n            if (ballB.vy > 5) ballB.vy = 5;\r\n            if (ballB.vy < -5) ballB.vy = -5;\r\n            if (ballB.vz > 5) ballB.vz = 5;\r\n            if (ballB.vz < -5) ballB.vz = -5;\r\n        }\r\n    }\r\n}\r\n\r\nfunction randomColor() {\r\n    var dice = Math.floor( Math.random() * 6 );\r\n    var R = Math.random() * 0.4;\r\n    var G = Math.random() * 0.4;\r\n    var B = Math.random() * 0.4;\r\n    var x = Math.random();\r\n    if ( dice == 0 ) return new THREE.Color( 1.0 - R, 0.0 + G, x );\r\n    if ( dice == 1 ) return new THREE.Color( 0.0 + R, 1.0 - G, x );\r\n    if ( dice == 2 ) return new THREE.Color( 1.0 - R, x, 0.0 + B );\r\n    if ( dice == 3 ) return new THREE.Color( 0.0 + R, x, 1.0 - B );\r\n    if ( dice == 4 ) return new THREE.Color( x, 0.0 + G, 1.0 - B );\r\n    if ( dice == 5 ) return new THREE.Color( x, 1.0 - G, 0.0 + B );\r\n}\r\n\r\n\r\nfunction rnd( a, b ) {\r\n    if (typeof a === 'undefined') a = 1;\r\n    if (typeof b === 'undefined') {\r\n        b = a;\r\n        a = 0;\r\n    }\r\n    return a + Math.random() * (b - a);\r\n}\r\n\r\n\r\nfunction constraint( v, min, max ) {\r\n    if (typeof min === 'undefined') min = 1;\r\n    if (typeof max === 'undefined') max = -min;\r\n\r\n    if (max < min) {\r\n        var tmp = min;\r\n        min = max;\r\n        max = tmp;\r\n    }\r\n\r\n    return Math.max( min, Math.min( max, v ) );\r\n}\r\n\r\n\r\n\r\nexports.bounds = bounds;\r\nexports.center = center;\r\nexports.move = moveBalls;\r\nexports.create = createBalls;\r\n }\r\n"],"names":["addListener","e","l","window","addEventListener","attachEvent","require","modules","id","body","mod","err","Error","console","error","stack","exports","document","parentNode","$data","APP","setTimeout","start","window","exports","module","config","name","description","author","version","major","minor","revision","date","Date","currentLang","lang","undefined","localStorage","getItem","navigator","language","browserLanguage","substr","toLowerCase","setItem","intl","words","params","txt","newTxt","i","c","lastIdx","pos","dic","k","length","charAt","substring","charCodeAt","window","exports","module","createFloorGrid","x","z","b","Balls","bounds","X","scene","add","createLine","vertices","y","Z","onWindowResize","W","innerWidth","H","innerHeight","camera","aspect","updateProjectionMatrix","renderer","setSize","anim","time","requestAnimationFrame","lastTime","fpsTime","nbFrames","fps","textContent","toFixed","delta","move","cameraMotion","moveCamera","render","cam","alpha","speed","beta","Math","abs","PI","radius","radiusTarget","min","max","R","r","cos","sin","position","target","lookAt","constraint","v","opt","color","linewidth","mat","THREE","LineBasicMaterial","geo","Geometry","forEach","vertex","push","Vector3","Line","require","Events","BALLS","document","getElementById","random","center","Scene","PerspectiveCamera","WebGLRenderer","setClearColor","setPixelRatio","devicePixelRatio","body","appendChild","domElement","create","mesh","addEventListener","events","onStart","onDrag","evt","sx","sy","onDblSwipe","onWheel","window","exports","module","getZoomAttributes","touches","x1","clientX","y1","clientY","x2","y2","cx","cy","dx","dy","radius","Math","sqrt","time","Date","now","element","handleMouseMove","event","preventDefault","stopPropagation","x","y","state","slots","onMove","t","d","max","t1","onDrag","x0","y0","xx","yy","sx","sy","handleMouseDown","t0","onStart","handleMouseUp","abs","threshold","onStop","handleTouchMove","length","z","console","log","onDblSwipe","zoom0","zoom1","handleTouchStart","handleTouchEnd","handleMouseWheel","delta","undefined","wheelDelta","detail","onWheel","evt","onZoom","onTap","target","wheelDelay","addEventListener","window","exports","module","createBalls","nbBalls","ball","meshes","i","mesh","THREE","Mesh","createGeo","createMat","vx","Math","random","vy","vz","x","rnd","bounds","X","y","Y","z","Z","flash","delta","position","set","balls","push","col","randomColor","vec","Vector3","r","g","b","mat","ShaderMaterial","uniforms","uni_Color","type","value","uni_Ratio","innerWidth","innerHeight","uni_Alpha","uni_Beta","uni_Time","uni_Speed","uni_Flash","vertexShader","document","getElementById","textContent","fragmentShader","transparent","geo","Geometry","vertices","faces","Face3","computeFaceNormals","computeVertexNormals","moveBalls","time","cameraMotion","impacts","min","bx","bX","by","bY","bz","bZ","speed","bounceBalls","forEach","pos","material","alpha","beta","max","this","a","ballA","ballB","nx","ny","nz","r2","proj","pA","pB","cx","cy","cz","length","sqrt","abs","dice","floor","R","G","B","Color","center","move","create"],"mappings":"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"}